"0","fgsea2tissue= function(tissue){"
"0","  index = removeindex('KEGG')"
"0","  resHSD = read.xlsx(paste0('../02.Figures/GSEA.HSDigDB.hallmark.', tissue, '.xlsx'),"
"0","                     sheet = 1) %>%"
"0","    filter(!grepl(index, pathway, ignore.case = TRUE)) %>%"
"0","    mutate(Group = 'Sucrose', Tissue = tissue)"
"0","  "
"0","  resJNK = read.xlsx(paste0('../02.Figures/GSEA.HSDigDB.hallmark.', tissue, '.xlsx'),"
"0","                     sheet = 2) %>%"
"0","    filter(!grepl(index, pathway, ignore.case = TRUE)) %>%"
"0","    mutate(Group = 'Sucrose+JNK_D1', Tissue = tissue)"
"0","  "
"0","  resJNK_D2 = read.xlsx(paste0('../02.Figures/GSEA.HSDigDB.hallmark.', tissue, '.xlsx'),"
"0","                        sheet = 3) %>%"
"0","    filter(!grepl(index, pathway, ignore.case = TRUE)) %>%"
"0","    mutate(Group = 'Sucrose+JNK_D2', Tissue = tissue)"
"0","  "
"0","  res = rbind(resHSD, resJNK, resJNK_D2)"
"0","  return(res)"
"0","}"
"0","resFgeas = rbind(fgsea2tissue('Liver'),"
"0","                 fgsea2tissue('Adipose'),"
"0","                 fgsea2tissue('Muscle'),"
"0","                 fgsea2tissue('Brain'))"
"0",""
"0","resFgeas_common = resFgeas %>% filter(padj < 0.05) %>% "
"0","  dplyr::select(pathway,Group,Tissue) %>% "
"0","  group_by(pathway) %>% tally() %>% "
"0","  filter(n > 5)"
"0",""
"0","resFgeas_P = resFgeas %>% filter(pathway %in% resFgeas_common$pathway) %>% "
"0","  left_join(resFgeas_common) %>% "
"0","  mutate(label = case_when(padj < 0.05 ~ '', TRUE ~ 'x')) %>% "
"0","  reorder_col(., 'Tissue') %>% "
"0","  mutate(Group = factor(Group, "
"0","                         levels = c(""Sucrose"","
"0","                                    ""Sucrose+JNK_D1"","
"0","                                    ""Sucrose+JNK_D2""))) %>% "
"0","  mutate(pathway = reorder(pathway, n)) %>% "
"0","  ggplot(., aes(Tissue, pathway)) +"
"0","  geom_point(aes(size = -log10(padj), color = NES)) +"
"0","  facet_wrap(~Group, nrow = 1) +"
"0","  geom_text(aes(label = label), size = 2.5, hjust = 0.5) +"
"0","  scale_color_gradient2(mid = 'white', low = '#1c92d2', "
"0","                        high = '#b20a2c', midpoint = 0) +"
"0","  theme_bw() +"
"0","  plot_theme('nogrid') +"
"0","  theme("
"0","    axis.text.y = element_text(color = 'black', size = 8),"
"0","    axis.text.x = element_text(color = 'black', size = 8, "
"0","                               angle = 45, hjust = 1),"
"0","    axis.title = element_blank()) +"
"0","  scale_size(range = c(.5,5)) +"
"0","  scale_y_discrete(expand = c(.05,.02))"
"2","Joining with `by = join_by(pathway)`"
"0","ggsave(resFgeas_P, filename = '../02.Figures/GSEA.msigdb.hallmark.4tissues.pdf',"
"0","       width = 8, height = 4)"
